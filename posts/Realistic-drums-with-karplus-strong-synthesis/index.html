<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Realistic drums with karplus-strong synthesis | Mike Moreno DSP </title> <meta name="author" content="Miguel Moreno"> <meta name="description" content="Documentation on [mymembrane~], an algorithm to synthesize realistic drum sounds."> <meta name="keywords" content="dsp, audio-plugins, music-tech, sound-design"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A5%B8&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://mikemorenodsp.github.io/posts/Realistic-drums-with-karplus-strong-synthesis/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="//"> Mike Moreno DSP </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/software/">Software </a> </li> <li class="nav-item "> <a class="nav-link" href="/learning/">Learning </a> </li> <li class="nav-item active"> <a class="nav-link" href="/posts/index.html">Posts </a> </li> <li class="nav-item "> <a class="nav-link" href="/portfolio/">Portfolio </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Realistic drums with karplus-strong synthesis</h1> <p class="post-meta"> Created in March 13, 2022 </p> <p class="post-tags"> <i class="fa-solid fa-calendar fa-sm"></i> 2022   ·   <i class="fa-solid fa-hashtag fa-sm"></i> documentation   <i class="fa-solid fa-hashtag fa-sm"></i> dsp   <i class="fa-solid fa-hashtag fa-sm"></i> physical modelling   <i class="fa-solid fa-hashtag fa-sm"></i> synthesis </p> </header> <article class="post-content"> <div id="markdown-content"> <p><code class="language-plaintext highlighter-rouge">[mymembrane~]</code> is a Pure Data instrument focused on the creation of acoustic drum-like sounds. It started as an attempt at creating an extended karplus-strong algorithm, but ended up resembling a snare drum due to the inharmonicity caused by the all-pass filter. In this document I will explain its components and how it works.</p> <h2 id="1-parameters">1. Parameters</h2> <p>First, let’s take an overview of the available parameters for this instrument:</p> <ul> <li> <strong>Frequency:</strong> sets the fundamental frequency of the delay-line.</li> <li> <strong>Feedback:</strong> sets the feedback amount of the delay-line.</li> <li> <strong>Damping:</strong> controls the cutoff frequency for the low-pass filter in the feedback section.</li> <li> <strong>All-pass Frequency:</strong> sets the frequency for the all-pass filter.</li> <li> <strong>All-pass Gain:</strong> controls the amount of feedback gain in the all-pass filter.</li> <li> <strong>Pitch Bend Decay:</strong> sets the decay time for the pitch envelope modulating the delay line’s frequency and the all-pass frequency.</li> <li> <strong>Noise Level:</strong> controls the amount of filtered white noise in the mix.</li> </ul> <h2 id="2-excitation">2. Excitation</h2> <p>The excitation source for this instrument is a combination of a single sine-wave cycle and a burst of filtered white noise. The single sine-wave cycle can be synthesized using a high precision audio ramp generator object (<code class="language-plaintext highlighter-rouge">vline~</code>) going through a cosine waveshaper (<code class="language-plaintext highlighter-rouge">cos~</code>) with an offset. It is important that the ramp has a length in milliseconds equal to one period of the fundamental frequency, so the same waveform can be repeated through the delay-line. Then, the ramp’s output can act as an amplitude envelope for the filtered white noise to add more harmonic content to the excitation source. The result will make the algorithm sound less like a string and more like a resonator with a clearer perception of the fundamental frequency.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/karplus-drums/01-Excitation_Source-480.webp 480w,/assets/img/posts/karplus-drums/01-Excitation_Source-800.webp 800w,/assets/img/posts/karplus-drums/01-Excitation_Source-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/posts/karplus-drums/01-Excitation_Source.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 470px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="3-karplus-strong-string-synthesis">3. Karplus-Strong string synthesis</h2> <p>The excitation waveform can then be used for the karplus-strong algorithm. This consists of a delay-line looped through a one-pole low-pass filter. This algorithm provides two parameters for the instrument: feedback amount and damping frequency. The first changes the amplitude in the feedback section which consequently affects the decay-time. The damping frequency controls the cutoff frequency of the low-pass filter therefore affecting both the “brightness” and decay-time. In order to extend the frequency range it is necessary to have a delay size over 50 ms and put a <code class="language-plaintext highlighter-rouge">block~ 1</code> object inside the delay-line subpatch to force Pure Data to compute samples one by one.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/karplus-drums/02-Karplus-Strong-1-480.webp 480w,/assets/img/posts/karplus-drums/02-Karplus-Strong-1-800.webp 800w,/assets/img/posts/karplus-drums/02-Karplus-Strong-1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/posts/karplus-drums/02-Karplus-Strong-1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/karplus-drums/02-Karplus-Strong-2-480.webp 480w,/assets/img/posts/karplus-drums/02-Karplus-Strong-2-800.webp 800w,/assets/img/posts/karplus-drums/02-Karplus-Strong-2-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/posts/karplus-drums/02-Karplus-Strong-2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 488px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="4-all-pass-filter">4. All-pass filter</h2> <p>In this instrument, the all-pass filter is the most important building block for creating an inharmonic drum-like sound. The type of all-pass filter being used is a Schroeder allpass comb filter, which is made by cascading a feedback comb-filter with a feedforward comb-filter. There are two parameters for this filter: the all-pass frequency and the all-pass gain. The all-pass frequency controls the delay time being read on the all-pass filter and affects the inharmonicity depending on the ratio between the delay-line’s frequency and the all-pass frequency. The all-pass gain controls the amount of the feedback gain in the all-pass filter and ranges from -1 to 1 to avoid infinite feedback. The resulting sound already sounds like a drum membrane being hit, but it is possible to add more modulations and layers to enhance its features.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/karplus-drums/03-All-pass_Filter-1-480.webp 480w,/assets/img/posts/karplus-drums/03-All-pass_Filter-1-800.webp 800w,/assets/img/posts/karplus-drums/03-All-pass_Filter-1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/posts/karplus-drums/03-All-pass_Filter-1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 536px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/karplus-drums/03-All-pass_Filter-2-480.webp 480w,/assets/img/posts/karplus-drums/03-All-pass_Filter-2-800.webp 800w,/assets/img/posts/karplus-drums/03-All-pass_Filter-2-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/posts/karplus-drums/03-All-pass_Filter-2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 789px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="5-pitch-bend">5. Pitch Bend</h2> <p>Using a ramp generator to modulate the frequency reinforces the drum-like quality to the sound. Additionally, the same ramp can be set to enhance the attack by distorting the first few milliseconds. Although the only parameter for this section is the ramp’s decay time, changing the ramp’s curve and the amount of frequency modulation will also affect the fundamental frequency perception and attack of the instrument.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/karplus-drums/04-Pitch-Bend-1-480.webp 480w,/assets/img/posts/karplus-drums/04-Pitch-Bend-1-800.webp 800w,/assets/img/posts/karplus-drums/04-Pitch-Bend-1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/posts/karplus-drums/04-Pitch-Bend-1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 646px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/karplus-drums/04-Pitch-Bend-2-480.webp 480w,/assets/img/posts/karplus-drums/04-Pitch-Bend-2-800.webp 800w,/assets/img/posts/karplus-drums/04-Pitch-Bend-2-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/posts/karplus-drums/04-Pitch-Bend-2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 745px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="6-snares">6. Snares</h2> <p>Finally, this instrument can be turned into a snare drum by adding snares using an envelope follower of the drum output to modulate the amplitude of a filtered white noise layer. Using a band-pass at 3 kHz to filter the white noise will provide a more credible snare sound. Changing the level of this layer can mean the difference between a snare drum sound and a regular drum.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/karplus-drums/05-Snares-480.webp 480w,/assets/img/posts/karplus-drums/05-Snares-800.webp 800w,/assets/img/posts/karplus-drums/05-Snares-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/posts/karplus-drums/05-Snares.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 651px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="7-conclusion">7. Conclusion</h2> <p>Although <code class="language-plaintext highlighter-rouge">[mymembrane~]</code> can provide some realistic acoustic drum sounds, the parameters could be reworked for easier sound design. For example, adding real physical-modelling variables such as tension and a variety of excitation sources like different drum sticks.</p> <p>This instrument is currently available for download at the pd-mkmr repository, under the instruments folder: <a href="https://github.com/MikeMorenoDSP/pd-mkmr" rel="external nofollow noopener" target="_blank">https://github.com/MikeMorenoDSP/pd-mkmr</a> and a demo can be heard here: <a href="https://youtu.be/SpC3t1EVF_Q" rel="external nofollow noopener" target="_blank">https://youtu.be/SpC3t1EVF_Q</a>.</p> <h2 id="references">References</h2> <ul> <li><a href="https://www.uaudio.com/blog/allpass-filters/" rel="external nofollow noopener" target="_blank">Universal Audio - Allpass Filters</a></li> <li><a href="https://ccrma.stanford.edu/~jos/pasp/Allpass_Two_Combs.html" rel="external nofollow noopener" target="_blank">Julius O. Smith - Allpass Two Combs</a></li> <li><a href="https://ccrma.stanford.edu/~jos/pasp/Extended_Karplus_Strong_Algorithm.html" rel="external nofollow noopener" target="_blank">Julius O. Smith - Extended Karplus Strong Algorithm</a></li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="//posts/macos-ux-for-windows/">macOS UX for Windows</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="//posts/pure-data-faq/">Pure Data FAQ</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="//posts/basic-waveforms/">Basic waveforms in pd vanilla</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="//posts/equal-loudness-oscillator/">Low-effort equal-loudness oscillator</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="//posts/documentation-ep-mk1/">EP-MK1 Documentation</a> </li> </div> </div> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Miguel Moreno. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>